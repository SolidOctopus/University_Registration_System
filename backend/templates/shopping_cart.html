{% extends "base.html" %}
{% block content %}
    {% include 'enroll_sidebar.html' %}

    <h2>Shopping Cart</h2>

    <table>
        <thead>
            <tr>
                <th>Course Code</th>
                <th>Course Name</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for cart_item in cart_items %}
            <tr>
                <td>{{ cart_item.course.course_code }}</td>
                <td>{{ cart_item.course.name }}</td>
                <td>
                    <!-- Add button to remove from cart -->
                    <button class="remove-from-cart" data-cart-id="{{ cart_item.id }}">Remove</button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    
    <!-- Button to finalize enrollment -->
    <form method="POST" action="{% url 'enroll_all_courses' %}">
        {% csrf_token %}
        <button type="submit">Enroll in All Courses</button>
    </form>
    
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            document.querySelectorAll('.remove-from-cart').forEach(function (button) {
                button.addEventListener('click', function () {
                    const cartId = this.getAttribute('data-cart-id');
                    
                    // Send AJAX request to remove course from the cart
                    fetch(`/remove_from_cart/${cartId}/`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': '{{ csrf_token }}'
                        },
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            alert('Course removed from the shopping cart.');
                            window.location.reload();  // Refresh the page to reflect changes
                        } else {
                            alert('Failed to remove course from the cart.');
                        }
                    })
                    .catch(error => console.error('Error:', error));
                });
            });
        });
    </script>
    {% endblock %}