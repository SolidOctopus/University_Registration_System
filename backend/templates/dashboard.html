{% extends 'base.html' %}

{% block content %}
<div class="dashboard-container">
    <h1>Dashboard</h1>
    <div id="calendar"></div>

    <!-- Display assignments grouped by week -->
    <div class="weekly-assignments">
        {% for week_data in weekly_assignments %}
        <div class="week-section">
            <h2>{{ week_data.week }}</h2>
            {% if week_data.assignments %}
                {% for assignment in week_data.assignments %}
                <div class="assignment-item">
                    <p>{{ assignment.title }}</p>
                    <p>Due: {{ assignment.due_date }}</p>
                </div>
                {% endfor %}
            {% else %}
                <p>Nothing Planned Yet</p>
            {% endif %}
        </div>
        {% endfor %}
    </div>
</div>

<!-- Left icons for courses, group projects, profile, grades, announcements, messages, help, and resources -->
<div class="left-icons">
    <div class="icon courses-icon" id="courses-icon" title="Courses">üìö</div>
    <div class="icon projects-icon" id="projects-icon" title="Group Projects">üë•</div>
    <div class="icon grades-icon" id="grades-icon" title="Grades">üìä</div>
    <div class="icon announcements-icon" id="announcements-icon" title="Announcements">üîî</div>
    <div class="icon messages-icon" id="messages-icon" title="Messages">üí¨</div>
    <div class="icon help-icon" id="help-icon" title="Help">‚ùì</div>
    <div class="icon resources-icon" id="resources-icon" title="Resources">üìö</div>
</div>

<!-- Sidebars for additional functionality -->
<div id="courses-sidebar" class="sidebar-left">
    <div class="sidebar-content">
        <h3>Your Courses</h3>
        {% for course in courses %}
        <a href="{% url 'course_overview' course.id %}">{{ course.name }}</a>
        {% endfor %}
    </div>
</div>

<div id="projects-sidebar" class="sidebar-left">
    <div class="sidebar-content">
        <h3>Group Projects</h3>
        {% for project in group_projects %}
        <a href="#">{{ project.name }}</a>
        {% endfor %}
    </div>
</div>

<div id="grades-sidebar" class="sidebar-left">
    <div class="sidebar-content">
        <h3>Your Grades</h3>
        {% for course in courses %}
        <p>{{ course.name }}: {{ course.grade }}</p>
        {% endfor %}
    </div>
</div>

<div id="announcements-sidebar" class="sidebar-left">
    <div class="sidebar-content">
        <h3>Announcements</h3>
        {% for announcement in announcements %}
        <p>{{ announcement.title }}: {{ announcement.details }}</p>
        {% endfor %}
    </div>
</div>

<div id="messages-sidebar" class="sidebar-left">
    <div class="sidebar-content">
        <h3>Messages</h3>
        {% for message in messages %}
        <p>{{ message.sender }}: {{ message.content }}</p>
        {% endfor %}
    </div>
</div>

<div id="help-sidebar" class="sidebar-left">
    <div class="sidebar-content">
        <h3>Help / Support</h3>
        <p>For help, contact support at: support@university.com</p>
        <a href="/support-docs">Support Docs</a>
    </div>
</div>

<div id="resources-sidebar" class="sidebar-left">
    <div class="sidebar-content">
        <h3>Resources</h3>
        <a href="#">Library Resources</a>
        <a href="#">Study Materials</a>
        <a href="#">Papers</a>
    </div>
</div>

<style>
    .dashboard-container {
        padding: 20px;
        text-align: center;
        margin-left: 70px; /* Adjust to move the dashboard away from the sidebar */
    }

    .left-icons {
        position: fixed;
        left: 0;
        top: 50%;
        transform: translateY(-50%);
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    .icon {
        background: none;
        padding: 0;
        border: none;
        font-size: 40px;
        color: #08063f;
        cursor: pointer;
        transition: transform 0.3s ease;
    }

    .icon:hover {
        transform: scale(1.5);
    }

    .icon:not(:hover) {
        transform: scale(0.8);
    }

    .fc-list-event-title {
        font-size: 14px;
        font-weight: bold;
    }

    .fc-list-event-time {
        color: #999;
        font-size: 12px;
    }

    .fc-list-table td {
        padding: 10px;
    }

    .assignment-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px;
        border-bottom: 1px solid #ccc;
    }

    .assignment-info {
        display: flex;
        align-items: center;
    }

    .assignment-info input[type="checkbox"] {
        margin-right: 10px;
    }

    .assignment-title {
        font-weight: bold;
        font-size: 14px;
    }

    .assignment-meta {
        font-size: 12px;
        color: #777;
    }

    .assignment-points {
        margin-right: 20px;
    }

    .assignment-status {
        color: green;
    }

    .sidebar-left {
        height: 100%;
        width: 0;
        position: fixed;
        top: 0;
        left: 0;
        background-color: rgba(51, 51, 51, 0.85);
        overflow-x: hidden;
        transition: width 0.3s;
        z-index: 1000;
        padding-top: 60px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
        border-radius: 0 20px 20px 0;
        backdrop-filter: blur(5px);
    }

    .sidebar-content {
        padding: 15px;
        color: #e8cd7d;
    }

    .weekly-assignments {
        margin-top: 20px;
    }

    .week-section {
        border: 1px solid #ddd;
        border-radius: 8px;
        margin-bottom: 20px;
        padding: 15px;
        background-color: #f9f9f9;
    }

    .week-section h2 {
        text-align: left;
        font-size: 18px;
        margin-bottom: 10px;
    }

    .assignment-item {
        margin-bottom: 10px;
        padding: 10px;
        background-color: #ffffff;
        border-radius: 5px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .assignment-item p {
        margin: 0;
    }

    .assignment-item p:first-child {
        font-weight: bold;
    }

</style>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        var calendarEl = document.getElementById('calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'listYear',
            headerToolbar: false, // Disable the header toolbar
            events: '/get-assignments/', // Endpoint to fetch assignments and announcements
            height: 'auto',
            dayHeaders: true,
            showNonCurrentDates: false,
            eventOrder: false, // Disable event ordering
            eventOverlap: false, // Allow events to overlap
            eventLimit: false, // Ensure no limit on number of events displayed
            eventContent: function(arg) {
                return {
                    html: `
                        <div class="assignment-row">
                            <div class="assignment-info">
                                <input type="checkbox">
                                <span class="assignment-title">${arg.event.title}</span>
                            </div>
                            <div class="assignment-meta">
                                <span class="assignment-points">${arg.event.extendedProps.points || 0} pts</span>
                                <span class="assignment-status">${arg.event.extendedProps.status || 'No Status'}</span>
                            </div>
                        </div>
                    `
                };
            },
        });

        calendar.on('eventsSet', function(events) {
            console.log("Events loaded in FullCalendar:", events);
            events.forEach(event => {
                console.log(`Event: ${event.title}, Start Date: ${event.start}, ID: ${event.id}, Status: ${event.extendedProps.status}`);
            });
        });

        calendar.render();
    });

    function handleSidebar(iconId, sidebarId) {
        const icon = document.getElementById(iconId);
        const sidebar = document.getElementById(sidebarId);

        icon.addEventListener("click", function () {
            sidebar.style.width = "250px";
        });

        sidebar.addEventListener("mouseleave", function () {
            sidebar.style.width = "0"; // Close automatically when mouse moves away
        });
    }

    handleSidebar("courses-icon", "courses-sidebar");
    handleSidebar("projects-icon", "projects-sidebar");
    handleSidebar("grades-icon", "grades-sidebar");
    handleSidebar("announcements-icon", "announcements-sidebar");
    handleSidebar("messages-icon", "messages-sidebar");
    handleSidebar("help-icon", "help-sidebar");
    handleSidebar("resources-icon", "resources-sidebar");
</script>

{% endblock %}
